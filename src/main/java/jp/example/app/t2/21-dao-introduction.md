# *T2.1*　DAOによるCRUD操作・検索 ～ DAOを導入してみる編

[Javaによるデータベース接続とCRUD操作のチュートリアル](../tutorials.md) > [DAOによるCRUD操作](./20-dao.md)

---
### 今回のチュートリアル対象

- コミット：なし
- クラス：なし

---

## 1. 概要

このチュートリアルでは、まずオブジェクト指向の再確認をして、それに続けてJDBCで接続する際の手順と比較してDAOを導入することについて解説します。

---

## 2. 事前準備

データベースの詳細については、データベース接続情報を含めて [データベース概要](../00-database.md) を参照してください。

---

## 3. オブジェクト指向という考え方

DAOを導入する意義を理解するには、まずオブジェクト指向の基本概念を再確認しておくとスムーズに理解できます。  
Javaの入門書などで書かれた内容の復習として、ここではDAOとの関係に絞ってまとめておきます。

### 3.1 カプセル化（情報隠蔽）
クラス内部で行う処理を外部から見えなくして必要なメソッドだけを見えるようにするしくみを **カプセル化** といいます。

- 呼び出し側は「どのように処理されるか」ではなく「何ができるか」に注目できる
- DAOでは、接続処理やSQLの実行といった手順を内部にまとめ、呼び出し側は以下のようなメソッドだけを利用できる
  - `getAllProducts()` → すべての商品を取得
  - `addProduct(Product p)` → 商品を登録

### 3.2 責務分担（Single Responsibility）
オブジェクト指向設計では、クラスごとに役割（責務）を分けることが推奨されます。

- DAOの責務：データベースアクセス専用
- 呼び出し側（アプリケーション本体）の責務：業務処理や画面処理

この分離によってコードが整理されるので、保守もしやすくなります。

### 3.3 抽象化
複雑な処理を「目的に合わせてわかりやすく表現すること」を **抽象化** といいます。

- JDBCでの複雑な手順（接続 → SQL実行 → 結果取得）を、DAOのメソッド呼び出しでシンプルに表現
- 利用者（DAOを呼び出す側のプログラムや開発者）は「何をしたいか」に集中したコードの実現

### 3.4 DAOとオブジェクト指向の関係
以上の考え方をまとめると、DAOはオブジェクト指向の基本概念を応用した設計例であることが理解できるでしょう。

| オブジェクト指向における概念 | DAOでの実例 |
| -------------------------- | ---------- |
| カプセル化／情報隠蔽         | 接続処理やSQL実行をDAO内部にまとめ、外部から見えなくする    |
| 責務分担                    | DAOはデータベースアクセス、呼び出し側は業務処理に専念できる |
| 抽象化                      | JDBCの複雑な手順を「メソッド呼び出し」という形で目的に沿った操作にまとめる |

以上のような理解を踏まえて、JDBCによる処理手順 を確認し、DAOを導入することでどのようにシンプルになるかを見ていきます。

---

## 4. DAO導入まで

### 4.1. JDBC接続によるCRUD操作での全件検索

JDBC接続によるCRUD操作での全件検索についての手順は以下のようになります：

  **手順-J1.** 実行するSQLを設定  
  **手順-J2.** データベース接続情報を取得  
  **手順-J3.** データベース接続オブジェクトの取得  
  **手順-J4.** SQL実行オブジェクトの取得  
  **手順-J5.** SQLの実行と結果セットの取得  
  **手順-J6.** 結果セットから商品リストに変換：convertToList(ResultSet)メソッドの呼び出し  
  **手順-J7.** 商品リストのすべての要素を表示  

この手順は大きく分けると

  1. SQLを実行するための準備
  2. SQLの実行
  3. 実行結果の処理（表示）

となります。  
この分類は、データベースに接続してレコード操作を実行するための基本的な分類となっています。

そこで、手順を基本分類に分けると、次の表のようになります：

| 基本分類 | 手順 | 具体的処理 |
| ------- | ---- | --------- |
| SQLを実行するための準備 | 手順-J1、手順-J2、手順-J3 | SQL文の作成、接続情報取得、データベース接続オブジェクトの取得 |
| SQLの実行              | 手順-J4、手順-J5 | SQL実行オブジェクトの取得、SQLの実行、結果セットの取得 |
| 実行結果の処理          | 手順-J6、手順-J7 | 結果セットを商品リストに変換して表示 |

つまり、JDBC接続によるCRUD操作は、手順-J1から手順-J3までの処理と手順-J4から手順-J5の処理と手順-J6から手順-J7までの処理、というまとまりとして整理できます。

ここでは、JDBC手順を整理してDAOに置き換えたとき、どの部分が隠蔽されるかを意識しましょう。

この分類を考慮すると、これらの手順は以下のようにまとめることができます：

  **手順-J'1.** SQL実行の準備  
  **手順-J'2.** すべての商品を取得して商品リストを生成  
  **手順-J'3.** 商品リストのすべての要素を表示
<!--
手順-J'3では下位の細かい手順は省略しています。
-->

このJ'1からJ'3までの手順とさきほどのJ1からJ7までの手順の対応は以下のようになります：

| 新しい分類による手順 | JDBC接続による手順 |
| ----------------- | ---------------- |
| 手順-J'1 | 手順-J1から手順-J3 |
| 手順-J'2 | 手順-J4、手順-J5   |
| 手順-J'3 | 手順-J6、手順-J7   |

### 4.2 処理をDAOオブジェクトに持たせる

手順をより大きな単位で整理すると、細かい処理は利用者から見えなくなります。  
具体的にいうと、手順-J’（整理後の手順）は、JDBCの細かい手順（J1～J7）を隠蔽したものです。
そこで、この隠蔽された手順を何処かで担保する必要が出てきます。

隠蔽された手順はDAOクラスの中にまとめておき、DAOがその処理を代わりに実行します。   
このようなオブジェクトを **DAO（Data Access Object）** といいます。
そして、この新しい手順-J'が **DAOの機能（または処理）** ということができます。

そこで、DAOを用いた全件検索の手順が以下のようになります：

  **手順-D1.** DAOオブジェクトの生成  
  **手順-D2.** すべての商品を取得して商品リストを生成 ⇒ DAOのメソッドの呼び出し  
  **手順-D3.** 商品リストのすべての要素を表示

手順-D2によって、CRUD操作のようにSQLが異なっていても、DAOのメソッドを呼び出すだけでその違いを内部に隠蔽できます。

以上のように手順を整理することで、プログラムの利用者はデータベース接続の詳細を意識する必要がなくなります。

たとえば「接続文字列をどこから取得するか」や「SQLをどのように実行するか」といった処理は隠蔽されるため、
利用者（DAOを呼び出す側のプログラムや開発者）は「商品一覧を取得する」といった目的に集中してコードを書くことができます。

結果として、アプリケーションの他の部分がデータベースの仕組みに依存せずに記述できるようになります。

以上がDAO導入の基本的な考え方です。

---

## 5. まとめ

ここのコードで学ぶべきポイント：

  - DAOはデータベースアクセスとSQL実行を担う
  - DAOを利用することで接続情報を意識せずに操作を行う
  - DAOはSQLの違いをクラス内部に隠蔽し、CRUD操作を簡潔に行う
  - DAOはオブジェクト指向の **カプセル化・責務分担・抽象化** を実践した設計例

DAOの具体的なクラス定義やメソッドの実装方法については、この後のチュートリアルで実際のコードを用いて解説します。  
このチュートリアルでは「DAOを導入すると、利用側の処理がシンプルになる」という全体像をつかむことを目的としています。

---

[Javaによるデータベース接続とCRUD操作のチュートリアル](../tutorials.md) > [DAOによるCRUD操作](./20-dao.md)
