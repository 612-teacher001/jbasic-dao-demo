# *T1.13* JDBC接続によるCRUD操作・更新 ～ 商品を更新してみた・共通メソッド化編

[Javaによるデータベース接続とCRUD操作のチュートリアル](../tutorials.md) > [JDBC接続によるCRUD操作](./10-jdbc.md)

### 今回のチュートリアル対象

- コミット：[eb8575c](https://github.com/612-teacher001/jbasic-dao-demo/commit/eb8575c)
- クラス：[`jp.example.app.t1.JdbcUpdate`](https://github.com/612-teacher001/jbasic-dao-demo/blob/main/src/main/java/jp/example/app/t1/JdbcUpdate.java)

👉 チュートリアルの進め方については [チュートリアルガイド](../guidance.md) を参照してください。

## 1. 概要

このチュートリアルで扱うプログラムは、productsテーブルにレコードを更新して、標準出力に全件表示するというものです。

このチュートリアルでは、**商品を更新する方法** について解説します。

## 2. 事前準備

データベースの詳細については、データベース接続情報を含めて [データベース概要](../00-database.md) を参照してください。

## 3. 手順ごとの解説

以下で解説する手順は `jp.example.app.t1.JdbcUpdate#main(String[])` メソッドのコードに記述されている「手順-X」と記述されたコメントに対応しています。  

今回のCRUD操作では大きく以下のような2つの操作を実行します：

1. 更新対象商品を取得する
2. 更新対象商品を更新する

これらはそれぞれデータベースにアクセスする必要があるので、ひとつのデータベース接続オブジェクトを取得してから個々の操作を実行するようにします。

### 手順-1. 全商品を表示する
### 手順-2. 商品更新のメッセージを表示する
### 手順-3. キーボードから更新する商品のIDを取得する
### 手順-4. データベース接続情報を取得
- ここはこれまでのチュートリアルで扱ったものと同じです。

### 手順-5. データベース接続オブジェクトを取得する
### 手順-6. 実行するSQLを設定する
### 手順-7. SQL実行オブジェクトを取得する
### 手順-8. SQLのプレースホルダを商品IDで置換する
### 手順-9. SQLの実行と結果セットを取得する
### 手順-10. 結果セットから商品インスタンスに変換する
- この手順をまとめて `getProductById(Connection, int)` メソッドにまとめました。  
このように共通化しておくことで以下のようなメリットがあります：
  - 同じ処理をメソッド呼び出しだけで何度も再利用することができる
  - SQL処理を `main` 処理から切り離すことができる
  - エラーが発生した際のエラー処理の範囲を狭くすることができる
- このメソッドでは、商品IDによる検索処理の結果を呼び出し元で再利用するために商品インスタンスを戻り値にしています。


### 手順-11. 商品の存在チェックをする
### 手順-12. 更新情報を取得する
### 手順-13. 更新情報で更新対象商品を更新する
- ここはこれまでのチュートリアルで扱ったものと同じです。

### 手順-14. 実行するSQLを設定する
### 手順-15. SQL実行オブジェクトを取得する
### 手順-16. SQLのプレースホルダを商品インスタンスのフィールド値で置換する
### 手順-17. SQLを実行する
- この手順をまとめて `updateProduct(Connection, Product)` メソッドにまとめました。  
このメソッドでは、データベースの商品レコードを更新する処理を実行するので戻り値のない `void` 系のメソッドにしています。

### 手順-18. 商品リストを表示する
- ここはこれまでのチュートリアルで扱ったものと同じです。

## 4. まとめ

ここのコードで学ぶべきポイント：

  - UPDATE文の実行には `executeUpdate` メソッドを使用すること
  - SQL処理を共通メソッドに切り出すことで main の見通しがよくなり、再利用しやすくなること

---

## 実習問題

以下の課題を進めるにあたっては `jp.example.exercise.t1.update` パッケージの中にクラスを作成してください。  
なお、クラス名は `Exercise11` のように「Exercise + 課題番号」の形式にして `main` メソッドに処理を記述してください。  
たとえば、課題-11の場合は「`Exercise11`」というクラスを作成します。

**［課題-21］**  前回のチュートリアルの［課題-11］で作成した部署テーブル更新プログラムを、更新対象部署を取得するメソッドと部署更新メソッドを定義して作り直してください（前回との差分として「共通メソッド化」を体感することがねらいです）。

---

[Javaによるデータベース接続とCRUD操作のチュートリアル](../tutorials.md) > [JDBC接続によるCRUD操作](./10-jdbc.md)

